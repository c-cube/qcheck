<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>QCheck_runner (qcheck.QCheck_runner)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../index.html">qcheck</a> &#x00BB; QCheck_runner</nav><header class="odoc-preamble"><h1>Module <code><span>QCheck_runner</span></code></h1></header><div class="odoc-content"><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../../qcheck-core/QCheck_base_runner/index.html">QCheck_base_runner</a> <span class="keyword">end</span></span></code></summary><h2 id="runners-for-tests"><a href="#runners-for-tests" class="anchor"></a>Runners for Tests</h2><p>Once you built some tests using <a href="../../qcheck-core/QCheck2/Test/index.html#val-make"><code>QCheck2.Test.make</code></a>, you need to run the tests. This module contains several <b>runners</b>, which are designed to run every test and report the result.</p><p>By default, you can use <a href="#val-run_tests"><code>run_tests</code></a> in a test program as follows:</p><pre><code>let testsuite = [
  Test.make ...;
  Test.make ...;
]

let () =
  let errcode = QCheck_base_runner.run_tests ~verbose:true testsuite in
  exit errcode</code></pre><p>which will run the tests, and exit the program. The error code will be 0 if all tests pass, 1 otherwise.</p><p><a href="#val-run_tests_main"><code>run_tests_main</code></a> can be used as a shortcut for that, also featuring command-line parsing (using <code>Arg</code>) to activate verbose mode and others.</p><h3 id="state"><a href="#state" class="anchor"></a>State</h3><div class="odoc-spec"><div class="spec value" id="val-random_state" class="anchored"><a href="#val-random_state" class="anchor"></a><code><span><span class="keyword">val</span> random_state : <span>unit <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Stdlib</span>.Random.State.t</span></code></div><div class="spec-doc"><p>Access the current random state</p></div></div><div class="odoc-spec"><div class="spec value" id="val-verbose" class="anchored"><a href="#val-verbose" class="anchor"></a><code><span><span class="keyword">val</span> verbose : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is the default mode verbose or quiet?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-long_tests" class="anchored"><a href="#val-long_tests" class="anchor"></a><code><span><span class="keyword">val</span> long_tests : <span>unit <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is the default mode to run long tests or nor?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_seed" class="anchored"><a href="#val-set_seed" class="anchor"></a><code><span><span class="keyword">val</span> set_seed : <span>int <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the <a href="#val-random_state"><code>random_state</code></a> by creating a new one, initialized with the given seed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_verbose" class="anchored"><a href="#val-set_verbose" class="anchor"></a><code><span><span class="keyword">val</span> set_verbose : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the value of <code>verbose ()</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-set_long_tests" class="anchored"><a href="#val-set_long_tests" class="anchor"></a><code><span><span class="keyword">val</span> set_long_tests : <span>bool <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Change the value of <code>long_tests ()</code></p></div></div><div class="odoc-spec"><div class="spec value" id="val-get_time_between_msg" class="anchored"><a href="#val-get_time_between_msg" class="anchor"></a><code><span><span class="keyword">val</span> get_time_between_msg : <span>unit <span class="arrow">&#45;&gt;</span></span> float</span></code></div><div class="spec-doc"><p>Get the minimum time to wait between printing messages.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.9</li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-set_time_between_msg" class="anchored"><a href="#val-set_time_between_msg" class="anchor"></a><code><span><span class="keyword">val</span> set_time_between_msg : <span>float <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Set the minimum tiem between messages.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.9</li></ul></div></div><h3 id="event-handlers"><a href="#event-handlers" class="anchor"></a>Event handlers</h3><div class="odoc-spec"><div class="spec type" id="type-counter" class="anchored"><a href="#type-counter" class="anchor"></a><code><span><span class="keyword">type</span> counter</span><span> = <span class="keyword">private</span> <a href="../../qcheck-core/QCheck_base_runner/index.html#type-counter">QCheck_base_runner.counter</a></span><span> = </span><span>{</span></code><table><tr id="type-counter.start" class="anchored"><td class="def record field"><a href="#type-counter.start" class="anchor"></a><code><span>start : float;</span></code></td></tr><tr id="type-counter.expected" class="anchored"><td class="def record field"><a href="#type-counter.expected" class="anchor"></a><code><span>expected : int;</span></code></td></tr><tr id="type-counter.gen" class="anchored"><td class="def record field"><a href="#type-counter.gen" class="anchor"></a><code><span><span class="keyword">mutable</span> gen : int;</span></code></td></tr><tr id="type-counter.passed" class="anchored"><td class="def record field"><a href="#type-counter.passed" class="anchor"></a><code><span><span class="keyword">mutable</span> passed : int;</span></code></td></tr><tr id="type-counter.failed" class="anchored"><td class="def record field"><a href="#type-counter.failed" class="anchor"></a><code><span><span class="keyword">mutable</span> failed : int;</span></code></td></tr><tr id="type-counter.errored" class="anchored"><td class="def record field"><a href="#type-counter.errored" class="anchor"></a><code><span><span class="keyword">mutable</span> errored : int;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>The type of counter used to keep tracks of the events received for a given test cell.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-handler" class="anchored"><a href="#type-handler" class="anchor"></a><code><span><span class="keyword">type</span> handler</span><span> = <a href="../../qcheck-core/QCheck_base_runner/index.html#type-handler">QCheck_base_runner.handler</a></span><span> = </span><span>{</span></code><table><tr id="type-handler.handler" class="anchored"><td class="def record field"><a href="#type-handler.handler" class="anchor"></a><code><span>handler : a. <span><span class="type-var">'a</span> <a href="../../qcheck-core/QCheck2/Test/index.html#type-handler">QCheck2.Test.handler</a></span>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>A type to represent polymorphic-enough handlers for test cells.</p></div></div><div class="odoc-spec"><div class="spec type" id="type-handler_gen" class="anchored"><a href="#type-handler_gen" class="anchor"></a><code><span><span class="keyword">type</span> handler_gen</span><span> = <span>colors:bool <span class="arrow">&#45;&gt;</span></span> <span>debug_shrink:<span><span class="xref-unresolved">Stdlib</span>.out_channel option</span> <span class="arrow">&#45;&gt;</span></span>
<span>debug_shrink_list:<span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>size:int <span class="arrow">&#45;&gt;</span></span> <span>out:<span class="xref-unresolved">Stdlib</span>.out_channel <span class="arrow">&#45;&gt;</span></span> <span>verbose:bool <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-counter">counter</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-handler">handler</a></span></code></div><div class="spec-doc"><p>An alias type to a generator of handlers for test cells.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-default_handler" class="anchored"><a href="#val-default_handler" class="anchor"></a><code><span><span class="keyword">val</span> default_handler : <a href="#type-handler_gen">handler_gen</a></span></code></div><div class="spec-doc"><p>The default handler used.</p></div></div><h3 id="run-a-suite-of-tests-and-get-results"><a href="#run-a-suite-of-tests-and-get-results" class="anchor"></a>Run a Suite of Tests and Get Results</h3><div class="odoc-spec"><div class="spec value" id="val-run_tests" class="anchored"><a href="#val-run_tests" class="anchor"></a><code><span><span class="keyword">val</span> run_tests : <span>?handler:<a href="#type-handler_gen">handler_gen</a> <span class="arrow">&#45;&gt;</span></span> <span>?colors:bool <span class="arrow">&#45;&gt;</span></span> <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?long:bool <span class="arrow">&#45;&gt;</span></span>
<span>?debug_shrink:<span><span class="xref-unresolved">Stdlib</span>.out_channel option</span> <span class="arrow">&#45;&gt;</span></span> <span>?debug_shrink_list:<span>string list</span> <span class="arrow">&#45;&gt;</span></span>
<span>?out:<span class="xref-unresolved">Stdlib</span>.out_channel <span class="arrow">&#45;&gt;</span></span> <span>?rand:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p>Run a suite of tests, and print its results. This is an heritage from the &quot;qcheck&quot; library.</p><ul class="at-tags"><li class="returns"><span class="at-tag">returns</span> <p>an error code, <code>0</code> if all tests passed, <code>1</code> otherwise.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">colors</span> <p>if true (default), colorful output</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">verbose</span> <p>if true, prints more information about test cases (default: <code>false</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">long</span> <p>if true, runs the long versions of the tests (default: <code>false</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">debug_shrink</span> <p><code>debug_shrink:(Some ch)</code> writes a log of successful shrink attempts to channel <code>ch</code>, for example <code>~debug_shrink:(Some (open_out &quot;mylog.txt&quot;))</code>. Use together with a non-empty list in <code>~debug_shrink_list</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">debug_shrink_list</span> <p>the test names to log successful shrink attempts for, for example <code>~debug_shrink_list:[&quot;list_rev_is_involutive&quot;]</code>. Requires <code>~debug_shrink</code> to be <code>Some ch</code>.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">out</span> <p>print output to the provided channel (default: <code>stdout</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">rand</span> <p>start the test runner in the provided RNG state</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-run_tests_main" class="anchored"><a href="#val-run_tests_main" class="anchor"></a><code><span><span class="keyword">val</span> run_tests_main : <span>?argv:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p>Can be used as the main function of a test file. Exits with a non-0 code if the tests fail. It refers to <a href="#val-run_tests"><code>run_tests</code></a> for actually running tests after CLI options have been parsed.</p><p>The available options are:</p><ul><li>&quot;--verbose&quot; (or &quot;-v&quot;) for activating verbose tests</li><li>&quot;--seed &lt;n&gt;&quot; (or &quot;-s &lt;n&gt;&quot;) for repeating a previous run by setting the random seed</li><li>&quot;--long&quot; for running the long versions of the tests</li></ul><p>Below is an example of the output of the <code>run_tests</code> and <code>run_tests_main</code> function:</p><pre>random seed: 438308050
generated  error;  fail; pass / total -     time -- test name
[✓] (1000)    0 ;    0 ; 1000 / 1000 --     0.5s -- list_rev_is_involutive
[✗] (   1)    0 ;    1 ;    0 /   10 --     0.0s -- should_fail_sort_id
[✗] (   1)    1 ;    0 ;    0 /   10 --     0.0s -- should_error_raise_exn
[✓] (1000)    0 ;    0 ; 1000 / 1000 --     0.0s -- collect_results

--- Failure --------------------------------------------------------------------

Test should_fail_sort_id failed (11 shrink steps):

[1; 0]

=== Error ======================================================================

Test should_error_raise_exn errored on (62 shrink steps):

0

exception QCheck_runner_test.Error
Raised at file &quot;example/QCheck_runner_test.ml&quot;, line 20, characters 20-25
Called from file &quot;src/QCheck.ml&quot;, line 839, characters 13-33


+++ Collect ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Collect results for test collect_results:

4: 207 cases
3: 190 cases
2: 219 cases
1: 196 cases
0: 188 cases

================================================================================
failure (1 tests failed, 1 tests errored, ran 4 tests)</pre></div></div><div class="odoc-spec"><div class="spec module" id="module-Color" class="anchored"><a href="#module-Color" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>Color</span><span> = <a href="../../qcheck-core/QCheck_base_runner/Color/index.html">QCheck_base_runner.Color</a></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-Raw" class="anchored"><a href="#module-Raw" class="anchor"></a><code><span><span class="keyword">module</span> </span><span>Raw</span><span> = <a href="../../qcheck-core/QCheck_base_runner/Raw/index.html">QCheck_base_runner.Raw</a></span></code></div></div></details></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">struct</span> <span class="keyword">include</span> <a href="../../qcheck-ounit/QCheck_ounit/index.html">QCheck_ounit</a> <span class="keyword">end</span></span></code></summary><h2 id="conversion-of-tests-to-ounit-tests"><a href="#conversion-of-tests-to-ounit-tests" class="anchor"></a>Conversion of tests to OUnit Tests</h2><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.9</li></ul><div class="odoc-spec"><div class="spec value" id="val-to_ounit_test" class="anchored"><a href="#val-to_ounit_test" class="anchor"></a><code><span><span class="keyword">val</span> to_ounit_test : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?long:bool <span class="arrow">&#45;&gt;</span></span> <span>?rand:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">OUnit</span>.test</span></code></div><div class="spec-doc"><p><code>to_ounit_test ~rand t</code> wraps <code>t</code> into a OUnit test</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">verbose</span> <p>used to print information on stdout (default: <code>verbose()</code>)</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">rand</span> <p>the random generator to use (default: <code>random_state ()</code>)</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-to_ounit_test_cell" class="anchored"><a href="#val-to_ounit_test_cell" class="anchor"></a><code><span><span class="keyword">val</span> to_ounit_test_cell : <span>?verbose:bool <span class="arrow">&#45;&gt;</span></span> <span>?long:bool <span class="arrow">&#45;&gt;</span></span> <span>?rand:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span>
<span><span><span class="type-var">_</span> <a href="../../qcheck-core/QCheck2/Test/index.html#type-cell">QCheck2.Test.cell</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">OUnit</span>.test</span></code></div><div class="spec-doc"><p>Same as <a href="#val-to_ounit_test"><code>to_ounit_test</code></a> but with a polymorphic test cell</p></div></div><div class="odoc-spec"><div class="spec value" id="val-(&gt;:::)" class="anchored"><a href="#val-(&gt;:::)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;:::) : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">OUnit</span>.test</span></code></div><div class="spec-doc"><p>Same as <code>OUnit.(&gt;:::)</code> but with a list of QCheck2 tests</p></div></div><div class="odoc-spec"><div class="spec value" id="val-to_ounit2_test" class="anchored"><a href="#val-to_ounit2_test" class="anchor"></a><code><span><span class="keyword">val</span> to_ounit2_test : <span>?rand:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span> <span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">OUnit2</span>.test</span></code></div><div class="spec-doc"><p><code>to_ounit2_test ?rand t</code> wraps <code>t</code> into a OUnit2 test</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">rand</span> <p>the random generator to use (default: a static seed for reproducibility), can be overridden with &quot;-seed&quot; on the command-line</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-to_ounit2_test_list" class="anchored"><a href="#val-to_ounit2_test_list" class="anchor"></a><code><span><span class="keyword">val</span> to_ounit2_test_list : <span>?rand:<span class="xref-unresolved">Stdlib</span>.Random.State.t <span class="arrow">&#45;&gt;</span></span> <span><span><a href="../../qcheck-core/QCheck2/Test/index.html#type-t">QCheck2.Test.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">OUnit2</span>.test list</span></span></code></div><div class="spec-doc"><p><code>to_ounit2_test_list ?rand t</code> like <code>to_ounit2_test</code> but for a list of tests</p></div></div><h3 id="ounit-runners"><a href="#ounit-runners" class="anchor"></a>OUnit runners</h3><p>QCheck provides some custom runners for OUnit tests.</p><ul><li><a href="#val-run"><code>run</code></a> is used by <a href="https://github.com/vincent-hugot/qtest">qtest</a>.</li><li><a href="#val-run_tap"><code>run_tap</code></a> should be compatible with <a href="https://en.wikipedia.org/wiki/Test_Anything_Protocol">TAP</a>.</li></ul><p>Note that <code>OUnit</code>.run_test_tt or <code>OUnit</code>.run_test_tt_main can be used as well, in particular when QCheck tests are mixed with normal unit tests.</p><p>For OUnit2 you can use <code>OUnit2</code>.run_test_tt_main.</p><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>?argv:<span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">OUnit</span>.test <span class="arrow">&#45;&gt;</span></span> int</span></code></div><div class="spec-doc"><p><code>run test</code> runs the test, and returns an error code that is <code>0</code> if all tests passed, <code>1</code> otherwise. This is the default runner used by the comment-to-test generator.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">argv</span> <p>the command line arguments to parse parameters from (default <code>Sys.argv</code>)</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Arg.Bad</span> <p>in case <code>argv</code> contains unknown arguments</p></li></ul><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Arg.Help</span> <p>in case <code>argv</code> contains &quot;--help&quot;</p><p>This test runner displays execution in a compact way, making it good for suites that have lots of tests.</p><p>Output example:</p><pre>random seed: 101121210
random seed: 101121210
\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
Error: tests&gt;error_raise_exn

test `error_raise_exn` raised exception `QCheck_ounit_test.Error`
on `0 (after 62 shrink steps)`
Raised at file &quot;example/QCheck_ounit_test.ml&quot;, line 19, characters 20-25
Called from file &quot;src/QCheck.ml&quot;, line 846, characters 13-33

///////////////////////////////////////////////////////////////////////////////
\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
Failure: tests&gt;fail_sort_id

fail_sort_id
///////////////////////////////////////////////////////////////////////////////
Ran: 4 tests in: 0.74 seconds.
WARNING! SOME TESTS ARE NEITHER SUCCESSES NOR FAILURES!</pre></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-run_tap" class="anchored"><a href="#val-run_tap" class="anchor"></a><code><span><span class="keyword">val</span> run_tap : <span><span class="xref-unresolved">OUnit</span>.test <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">OUnit</span>.test_results</span></code></div><div class="spec-doc"><p>TAP-compatible test runner, in case we want to use a test harness. It prints one line per test.</p></div></div></details></div></div></body></html>